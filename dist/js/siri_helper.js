"use strict";var NetConnector=function(){this.profile="uat_ip",this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){window.localStorage.token=t},getAjaxHost:function(t){var e=null;switch(t){case"uat_ip":e="http://10.19.93.129:8090/";break;case"uat":e="http://mtest.iqianjin.com/";break;case"product":e="https://m.benew.com.cn/"}return e},_getURL:function(t,e){var a=this.getAjaxHost(this.profile),o=null;switch(t){case"ASK":o="bot/api/v1/botServer/sessionOperator/receiveh5?msg="+e;break;case"REFRESH":o="bot/api/v1/botServer/sessionOperator/flashh5?msg="+e+"refresh"}var s=window.localStorage.token;return a+o+(s?"&token="+s:"")},throttle:function(t,e){"function"==typeof t&&(clearTimeout(t.timeoutId),t.timeoutId=setTimeout(function(){try{"object"==typeof e?t.call(null,e):t.call(null)}catch(t){console.log(t)}},300))},askServer:function(t,e){var a=t.type,o=t.question;switch(a){case"ASK_HINT":break;case"ASK":this._getSIRIAnswer(a,o,e);break;case"REFRESH":this._getSIRIAnswer(a,o,e);break;default:this._getSIRIAnswer(a,o,e)}},_getSIRIAnswer:function(t,e,a){var o=this,s=function(t){o.setToken(t.token);for(var e=t.content,s=[],r=0;r<e.length;r++){var n=e[r];if("type"in n)switch(n.type){case"recommend":s=n;break;case"help":s.push({style:o.answerStyle.ASK_HINT,content:n.data.body});break;case"hot":s.push({style:o.answerStyle.STOCK_HOT,content:n.data.body});break;case"forecast":s.push({style:o.answerStyle.STOCK_FORECAST,content:n.data.body});break;case"plain":s.push({style:o.answerStyle.PLAIN_TEXT,content:n.data.body});break;case"quotation":s.push({style:o.answerStyle.STOCK_QUOTATION,content:o._formatStockQuotation(n.data)});break;case"optimization":s.push({style:o.answerStyle.HOT_STOCKS,content:o._formatHotStocks(n.data)})}}a(null,s)},r=(window.localStorage.token,this._getURL(t,e));$.output(r),$.ajax({url:r,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,success:function(t){$.output(t),0===parseInt(t.code)?s(t):a(new Error("data not valid"))},error:function(t,e,o){a(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,a=t.predictLinks,o=e.date;return e.date=$.toLocaleFormat(new Date(o),"yyyy.MM.dd"),e.stocks.forEach(function(t){var e=parseFloat(t.topen),a=100*parseFloat(t.pchg),o="";t.topen=e.toFixed(2),a>0?(a="+"+a.toFixed(2)+"%",o="up"):a<0?(a=a.toFixed(2)+"%",o="down"):(a=a.toFixed(2)+"%",o="stay"),t.formated_pchg=a,t.pchg_state=o}),e.link=a[0],e},_formatStockQuotation:function(t){var e=t.body,a=t.predictLinks,o="";switch(e.stockStatus.toUpperCase()){case"S":o="开市前";break;case"C":o="集合竞价";break;case"T":o="交易中";break;case"B":o="休市";break;case"E":o="收盘";break;case"P":o="停牌"}e.stockStatus=o;var s=e.tradePrice;e.tradePrice=s.toFixed(2);var r=e.tradeDate;e.tradeDate=r.substr(4,2)+"-"+r.substr(6,2);var n=e.tradeTime;e.tradeTime=n.substr(0,2)+":"+n.substr(2,2)+":"+n.substr(4,2);var c=100*e.pchg,i="";c>0?(c="+"+c.toFixed(2)+"%",i="up"):c<0?(c=c.toFixed(2)+"%",i="down"):(c=c.toFixed(2)+"%",i="stay"),e.formated_pchg=c,e.pchg_state=i;var u=e.change;u>0&&(u="+"+u),e.change=u,e.thigh=e.thigh.toFixed(2),e.topen=e.topen.toFixed(2),e.tlow=e.tlow.toFixed(2),e.lclose=e.lclose.toFixed(2);var l=[];return a.forEach(function(t){l.push(t.text)}),e.links=l,e}};