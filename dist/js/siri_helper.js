var NetConnector=function(){this.profile="product",this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){localStorage.token=t},getURL:function(t){var e=$.getAjaxHost(this.profile),o="bot/api/v1/botServer/sessionOperator/receiveh5?msg="+t,a=localStorage.token;return e+o+(a?"&token="+a:"")},throttle:function(t,e){"function"==typeof t&&(clearTimeout(t.timeoutId),t.timeoutId=setTimeout(function(){try{"object"==typeof e?t.call(null,e):t.call(null)}catch(t){console.log(t)}},300))},askServer:function(t,e){var o=t.type,a=t.question;switch(o){case"ASK_HINT":break;case"ASK":default:this._getSIRIAnswer(a,e)}},_getSIRIAnswer:function(t,e){var o=this,a=function(t){o.setToken(t.token);for(var a=t.content,n=[],s=0;s<a.length;s++){var c=a[s];if("type"in c)switch(c.type){case"recommend":n=c;break;case"help":n.push({style:o.answerStyle.ASK_HINT,content:c.data.body});break;case"hot":n.push({style:o.answerStyle.STOCK_HOT,content:c.data.body});break;case"forecast":n.push({style:o.answerStyle.STOCK_FORECAST,content:c.data.body});break;case"plain":n.push({style:o.answerStyle.PLAIN_TEXT,content:c.data.body});break;case"quotation":n.push({style:o.answerStyle.STOCK_QUOTATION,content:o._formatStockQuotation(c.data)});break;case"optimization":n.push({style:o.answerStyle.HOT_STOCKS,content:o._formatHotStocks(c.data)})}}e(null,n)},n=(localStorage.token,this.getURL(t));$.output(n),$.ajax({url:n,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,success:function(t){$.output(t),0==t.code?a(t):e(new Error("data not valid"))},error:function(t,o,a){e(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,o=t.predictLinks,a=e.date,a=$.toLocaleFormat(new Date(a),"yyyy.MM.dd");return e.date=a,e.stocks.forEach(function(t){var e=parseFloat(t.topen),o=100*parseFloat(t.pchg),a="";t.topen=e.toFixed(2),o>0?(o="+"+o.toFixed(2)+"%",a="up"):o<0?(o=o.toFixed(2)+"%",a="down"):(o=o.toFixed(2)+"%",a="stay"),t.formated_pchg=o,t.pchg_state=a}),e.link=o[0],e},_formatStockQuotation:function(t){var e=t.body,o=t.predictLinks,a="";switch(e.stockStatus.toUpperCase()){case"S":a="开市前";break;case"C":a="集合竞价";break;case"T":a="交易中";break;case"B":a="休市";break;case"E":a="收盘";break;case"P":a="停牌"}e.stockStatus=a;var n=e.tradeDate;e.tradeDate=n.substr(4,2)+"-"+n.substr(6,2);var s=e.tradeTime;e.tradeTime=s.substr(0,2)+":"+s.substr(2,2)+":"+s.substr(4,2);var c=100*e.pchg,r="";c>0?(c="+"+c.toFixed(2)+"%",r="up"):c<0?(c=c.toFixed(2)+"%",r="down"):(c=c.toFixed(2)+"%",r="stay"),e.formated_pchg=c,e.pchg_state=r;var i=e.change;i>0&&(i="+"+i),e.change=i,e.thigh=e.thigh.toFixed(2),e.topen=e.topen.toFixed(2),e.tlow=e.tlow.toFixed(2),e.lclose=e.lclose.toFixed(2);var d=[];return o.forEach(function(t){d.push(t.text)}),e.links=d,e},set_test_data:function(){this.recommendAnswer={code:0,dt:1486624881551,status:"success",content:[{type:"recommend",data:{body:[{studio:"你可以这样问",items:["600519","开户","选股","KDJ","茅台行情"]},{studio:"你可以这样问",items:["热议榜","洗盘","600519","茅台指标","茅台行情"]}],predictLink:[]}}]},this.quotationAnswer={code:0,dt:1486624881551,status:"success",content:[{type:"plain",data:{body:"该股票行情如下：",predictLink:[]}},{type:"quotation",data:{body:{tradeName:"贵州茅台",tradeCode:"600519",stockStatus:"交易中",tradePrice:358.74,change:"2.55%",pchg:"10.01%",tradeDate:"2017-02-22",tradeTime:"10:37:03",topen:362.43,lclose:362.43,thigh:362.43,tlow:352.43},predictLink:[{text:"预测",style:"isRed",link:"",value:"预测"},{text:"热点",style:"",link:"",value:"热点"},{text:"选股",style:"",link:"http:\\#",value:"选股"}]}}]},this.choosedStocks={code:0,dt:1486624881551,status:"success",content:[{type:"optimization",data:{body:{date:"2017-02-23",stocks:[{name:"航天电子",code:"600879",topen:16.89,pchg:"1.29%"},{name:"东方铁塔",code:"002545",topen:11.82,pchg:"-0.51%"}]},predictLink:[{text:"点击获取更多",style:"link",link:"http://#h5页面",value:"点击获取更多"}]}}]}}};