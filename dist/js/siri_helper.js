"use strict";var NetConnector=function(t){this.profile="uat",this.ajaxHeaders=t,this.ajaxHeaders.token=window.localStorage.token,this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){t&&window.localStorage.token!==t&&(window.localStorage.token=t,this.ajaxHeaders.token=t)},getAjaxHost:function(t){var e=null;switch(t){case"uat_ip":e="http://10.19.93.129:8090/";break;case"uat":e="http://mtest.iqianjin.com/";break;case"product":e="https://m.benew.com.cn/"}return e},getQueryString:function(t){var e=[],a=function(t){for(var a in t){var o=t[a];null!==o&&void 0!==o&&(o=o.toString(),a.length>0&&o.length>0&&e.push(a+"="+t[a]))}};return a(this.ajaxHeaders),a(t),e.join("&")},_getURL:function(t){var e=t.askType,a=this.getAjaxHost(this.profile),o=(window.localStorage.token,null);switch(e){case"FIRST_ASK":o="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({benew_id:t.benewId,msg:t.question});break;case"ASK":o="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({msg:t.question});break;case"REFRESH":o="bot/api/v1/botServer/sessionOperator/flashh5?"+this.getQueryString({msg:t.question})}return a+o},throttle:function(t,e){"function"==typeof t&&(clearTimeout(t.timeoutId),t.timeoutId=setTimeout(function(){try{"object"==typeof e?t.call(null,e):t.call(null)}catch(t){window.console.log(t)}},300))},askServer:function(t,e){var a=t.askType;switch(a){case"FIRST_ASK":this._getSIRIAnswer(t,e);break;case"ASK":this._getSIRIAnswer(t,e);break;case"REFRESH":this._getSIRIAnswer(t,e);break;default:this._getSIRIAnswer(t,e)}},_getSIRIAnswer:function(t,e){var a=this,o=function(t){a.setToken(t.token);var o=null;"dt"in t&&(o=t.dt);var r=t.content,n=[];n.dt=o;for(var s=0;s<r.length;s++){var i=r[s];if("type"in i)switch(i.type){case"recommend":n=i;break;case"help":n.push({style:a.answerStyle.ASK_HINT,content:i.data.body});break;case"hot":n.push({style:a.answerStyle.STOCK_HOT,content:i.data.body});break;case"forecast":n.push({style:a.answerStyle.STOCK_FORECAST,content:i.data.body});break;case"plain":n.push({style:a.answerStyle.PLAIN_TEXT,content:i.data.body});break;case"quotation":n.push({style:a.answerStyle.STOCK_QUOTATION,content:a._formatStockQuotation(i.data)});break;case"optimization":n.push({style:a.answerStyle.HOT_STOCKS,content:a._formatHotStocks(i.data)})}}e(null,n)},r=this._getURL(t);$.output(r),$.ajax({url:r,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,headers:this.ajaxHeaders,success:function(t){$.output(t),0===parseInt(t.code)?o(t):e(new Error("data not valid"))},error:function(t,a,o){e(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,a=t.predictLinks,o=e.date;return e.date=$.formatDate(new Date(o),"yyyy.MM.dd"),e.stocks.forEach(function(t){var e=parseFloat(t.topen),a=100*parseFloat(t.pchg),o="";t.topen=e.toFixed(2),a>0?(a="+"+a.toFixed(2)+"%",o="up"):a<0?(a=a.toFixed(2)+"%",o="down"):(a=a.toFixed(2)+"%",o="stay"),t.formated_pchg=a,t.pchg_state=o}),e.link=a[0],e},_formatStockQuotation:function(t){var e=t.body,a=t.predictLinks,o="";switch(e.stockStatus.toUpperCase()){case"S":o="开市前";break;case"C":o="集合竞价";break;case"T":o="交易中";break;case"B":o="休市";break;case"E":o="收盘";break;case"P":o="停牌"}e.stockStatus=o;var r=e.tradePrice;e.tradePrice=r.toFixed(2);var n=e.tradeDate;e.tradeDate=n.substr(4,2)+"-"+n.substr(6,2);var s=e.tradeTime;e.tradeTime=s.substr(0,2)+":"+s.substr(2,2)+":"+s.substr(4,2);var i=100*e.pchg,c="";i>0?(i="+"+i.toFixed(2)+"%",c="up"):i<0?(i=i.toFixed(2)+"%",c="down"):(i=i.toFixed(2)+"%",c="stay"),e.formated_pchg=i,e.pchg_state=c;var u=e.change;u>0&&(u="+"+u),e.change=u,e.thigh=e.thigh.toFixed(2),e.topen=e.topen.toFixed(2),e.tlow=e.tlow.toFixed(2),e.lclose=e.lclose.toFixed(2);var d=[];return a.forEach(function(t){d.push(t.text)}),e.links=d,e}};