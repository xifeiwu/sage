"use strict";var NetConnector=function(){this.profile="uat",this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){t&&localStorage.token!==t&&(window.localStorage.token=t)},getAjaxHost:function(t){var e=null;switch(t){case"uat_ip":e="http://10.19.93.129:8090/";break;case"uat":e="http://mtest.iqianjin.com/";break;case"product":e="https://m.benew.com.cn/"}return e},getQueryString:function(t){var e=[];for(key in t){var o=t[key];null!==o&&(o=o.toString(),key.length>0&&o.length>0&&e.push(key+"="+t[key]))}return e.join("&")},_getURL:function(t){var e=t.askType,o=this.getAjaxHost(this.profile),a=window.localStorage.token,n=null;switch(e){case"FIRST_ASK":n="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({benew_id:t.benewId,token:a,msg:t.question});break;case"ASK":n="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({token:a,msg:t.question});break;case"REFRESH":n="bot/api/v1/botServer/sessionOperator/flashh5?"+this.getQueryString({token:a,msg:t.question})}return o+n},throttle:function(t,e){"function"==typeof t&&(clearTimeout(t.timeoutId),t.timeoutId=setTimeout(function(){try{"object"==typeof e?t.call(null,e):t.call(null)}catch(t){console.log(t)}},300))},askServer:function(t,e){var o=t.askType;switch(o){case"FIRST_ASK":this._getSIRIAnswer(t,e);break;case"ASK":this._getSIRIAnswer(t,e);break;case"REFRESH":this._getSIRIAnswer(t,e);break;default:this._getSIRIAnswer(t,e)}},_getSIRIAnswer:function(t,e){var o=this,a=function(t){o.setToken(t.token);for(var a=t.content,n=[],r=0;r<a.length;r++){var s=a[r];if("type"in s)switch(s.type){case"recommend":n=s;break;case"help":n.push({style:o.answerStyle.ASK_HINT,content:s.data.body});break;case"hot":n.push({style:o.answerStyle.STOCK_HOT,content:s.data.body});break;case"forecast":n.push({style:o.answerStyle.STOCK_FORECAST,content:s.data.body});break;case"plain":n.push({style:o.answerStyle.PLAIN_TEXT,content:s.data.body});break;case"quotation":n.push({style:o.answerStyle.STOCK_QUOTATION,content:o._formatStockQuotation(s.data)});break;case"optimization":n.push({style:o.answerStyle.HOT_STOCKS,content:o._formatHotStocks(s.data)})}}e(null,n)},n=this._getURL(t);$.output(n),$.ajax({url:n,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,success:function(t){$.output(t),0===parseInt(t.code)?a(t):e(new Error("data not valid"))},error:function(t,o,a){e(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,o=t.predictLinks,a=e.date;return e.date=$.toLocaleFormat(new Date(a),"yyyy.MM.dd"),e.stocks.forEach(function(t){var e=parseFloat(t.topen),o=100*parseFloat(t.pchg),a="";t.topen=e.toFixed(2),o>0?(o="+"+o.toFixed(2)+"%",a="up"):o<0?(o=o.toFixed(2)+"%",a="down"):(o=o.toFixed(2)+"%",a="stay"),t.formated_pchg=o,t.pchg_state=a}),e.link=o[0],e},_formatStockQuotation:function(t){var e=t.body,o=t.predictLinks,a="";switch(e.stockStatus.toUpperCase()){case"S":a="开市前";break;case"C":a="集合竞价";break;case"T":a="交易中";break;case"B":a="休市";break;case"E":a="收盘";break;case"P":a="停牌"}e.stockStatus=a;var n=e.tradePrice;e.tradePrice=n.toFixed(2);var r=e.tradeDate;e.tradeDate=r.substr(4,2)+"-"+r.substr(6,2);var s=e.tradeTime;e.tradeTime=s.substr(0,2)+":"+s.substr(2,2)+":"+s.substr(4,2);var i=100*e.pchg,c="";i>0?(i="+"+i.toFixed(2)+"%",c="up"):i<0?(i=i.toFixed(2)+"%",c="down"):(i=i.toFixed(2)+"%",c="stay"),e.formated_pchg=i,e.pchg_state=c;var u=e.change;u>0&&(u="+"+u),e.change=u,e.thigh=e.thigh.toFixed(2),e.topen=e.topen.toFixed(2),e.tlow=e.tlow.toFixed(2),e.lclose=e.lclose.toFixed(2);var l=[];return o.forEach(function(t){l.push(t.text)}),e.links=l,e}};