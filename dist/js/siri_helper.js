var NetConnector=function(){this.profile="uat_ip",this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){localStorage.token=t},getURL:function(t){var e=$.getAjaxHost(this.profile),s="bot/api/v1/botServer/sessionOperator/receiveh5?msg="+t,a=localStorage.token;return e+s+(a?"&token="+a:"")},askServer:function(t,e){var s=t.type,a=t.question;switch(s){case"ASK_HINT":break;case"ASK":default:this._getSIRIAnswer(a,e)}},_getSIRIAnswer:function(t,e){var s=this,a=function(t){s.setToken(t.token);for(var a=t.content,o=[],r=0;r<a.length;r++){var i=a[r];if("type"in i)switch(i.type){case"recommend":o=i;break;case"help":o.push({style:s.answerStyle.ASK_HINT,content:i.data.body});break;case"hot":o.push({style:s.answerStyle.STOCK_HOT,content:i.data.body});break;case"forecast":o.push({style:s.answerStyle.STOCK_FORECAST,content:i.data.body});break;case"plain":o.push({style:s.answerStyle.PLAIN_TEXT,content:i.data.body});break;case"quotation":o.push({style:s.answerStyle.STOCK_QUOTATION,content:s._formatStockQuotation(i.data)});break;case"optimization":o.push({style:s.answerStyle.HOT_STOCKS,content:s._formatHotStocks(i.data)})}}e(null,o)},o=(localStorage.token,this.getURL(t));$.output(o),$.ajax({url:o,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,success:function(t){$.output(t),0==t.code?a(t):e(new Error("data not valid"))},error:function(t,s,a){e(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,s=t.predictLinks,a=e.date,a=$.toLocaleFormat(new Date(a),"yyyy.MM.dd");return e.date=a,e.stocks.forEach(function(t){var e=parseFloat(t.topen),s=100*parseFloat(t.pchg),a="";t.topen=e.toFixed(2),s>0?(s="+"+s.toFixed(2)+"%",a="up"):s<0?(s="-"+s.toFixed(2)+"%",a="down"):(s=s.toFixed(2)+"%",a="stay"),t.formated_pchg=s,t.pchg_state=a}),e.link=s[0],e},_formatStockQuotation:function(t){var e=t.body,s=t.predictLinks,a="";switch(e.stockStatus.toUpperCase()){case"S":a="开市前";break;case"C":a="集合竞价";break;case"T":a="交易中";break;case"B":a="休市";break;case"E":a="收盘";break;case"P":a="停牌"}e.stockStatus=a;var o=e.tradeDate;e.tradeDate=o.substr(4,2)+"-"+o.substr(6,2);var r=e.tradeTime;e.tradeTime=r.substr(0,2)+":"+r.substr(2,2)+":"+r.substr(4,2);var i=100*e.pchg,n="";i>0?(i="+"+i.toFixed(2)+"%",n="up"):i<0?(i="-"+i.toFixed(2)+"%",n="down"):(i=i.toFixed(2)+"%",n="stay"),e.formated_pchg=i,e.pchg_state=n;var d=[];return s.forEach(function(t){d.push(t.text)}),e.links=d,e},set_test_data:function(){this.recommendAnswer={code:0,dt:1486624881551,status:"success",content:[{type:"recommend",data:{body:[{studio:"你可以这样问",items:["600519","开户","选股","KDJ","茅台行情"]},{studio:"你可以这样问",items:["热议榜","洗盘","600519","茅台指标","茅台行情"]}],predictLink:[]}}]},this.quotationAnswer={code:0,dt:1486624881551,status:"success",content:[{type:"plain",data:{body:"该股票行情如下：",predictLink:[]}},{type:"quotation",data:{body:{tradeName:"贵州茅台",tradeCode:"600519",stockStatus:"交易中",tradePrice:358.74,change:"2.55%",pchg:"10.01%",tradeDate:"2017-02-22",tradeTime:"10:37:03",topen:362.43,lclose:362.43,thigh:362.43,tlow:352.43},predictLink:[{text:"预测",style:"isRed",link:"",value:"预测"},{text:"热点",style:"",link:"",value:"热点"},{text:"选股",style:"",link:"http:\\#",value:"选股"}]}}]},this.choosedStocks={code:0,dt:1486624881551,status:"success",content:[{type:"optimization",data:{body:{date:"2017-02-23",stocks:[{name:"航天电子",code:"600879",topen:16.89,pchg:"1.29%"},{name:"东方铁塔",code:"002545",topen:11.82,pchg:"-0.51%"}]},predictLink:[{text:"点击获取更多",style:"link",link:"http://#h5页面",value:"点击获取更多"}]}}]}},createAnswer:function(t){var e=$("#"+t.cardName).find(".answer_row .ans_cont").eq(1),s="";if(e.addClass("temp_unvisible"),1==t.type)if(0==this.sessionStatus){var a=JSON.parse(t.data.SceneResult).sContent;e.html('<div class="ans_box">'+a+"</div>"),this.hideLoading(t),this.reSetDomStructure(t)}else{var o={cardName:t.cardName,url:"/InvestAdvise/"+this.cardData[t.cardName].UrlKey+".html?dt_from="+this.from};if(this.sMultiCondition&&(this.oldSMultiCondition=this.sMultiCondition),1==this.sessionStatus&&"cardMoneyFlow"!=this.cardData[t.cardName].UrlKey){for(var r=0;r<this.shareWords.length;r++)s+=0==r?this.shareWords[r]:"+"+this.shareWords[r];s+="+"+t.words,o.url="/InvestAdvise/cardMoneyFlow.html?dt_from="+this.from+"&words="+encodeURIComponent(s)+"&returnPre=1"}var i=this.createIframe(o);$(i).appendTo(e)}else if(0==t.type){if(""==this.cardData[t.cardName].UrlKey)return e.html('<div class="ans_box">这个问题表哥有点处理不过来，请稍后再试</div>'),this.reSetDomStructure(t),void this.hideLoading(t);var o={cardName:t.cardName,url:"/InvestAdvise/"+this.cardData[t.cardName].UrlKey+".html?dt_from="+this.from};if("cardMoneyFlow"==this.cardData[t.cardName].UrlKey){var n=JSON.parse(t.data.SceneResult).vIAPickStock;if(0==JSON.parse(t.data.SceneResult).iIsShowMultiCondCard&&1==window.parent.intelligentAnswer.sessionStatus&&(n=[]),0==n.length){for(var r=0;r<this.shareWords.length;r++)s+=0==r?this.shareWords[r]:"+"+this.shareWords[r];""!=s?s+="+"+t.words:s=t.words,o.url=o.url+"&words="+encodeURIComponent(s)+"&returnPre=1"}else{this.shareWords.push(t.words);for(var r=0;r<this.shareWords.length;r++)s+=0==r?this.shareWords[r]:"_"+this.shareWords[r];o.url=o.url+"&words="+encodeURIComponent(s)+"&returnPre=0"}this.sMultiCondition&&(this.oldSMultiCondition=this.sMultiCondition),this.sMultiCondition=JSON.parse(t.data.SceneResult).sMultiCondition}if(1==this.sessionStatus&&"cardMoneyFlow"!=this.cardData[t.cardName].UrlKey){this.sMultiCondition&&(this.oldSMultiCondition=this.sMultiCondition);for(var r=0;r<this.shareWords.length;r++)s+=0==r?this.shareWords[r]:"+"+this.shareWords[r];s+="+"+t.words,o.url="/InvestAdvise/cardMoneyFlow.html?dt_from="+this.from+"&words="+encodeURIComponent(s)+"&returnPre=1"}var i=this.createIframe(o);$(i).appendTo(e)}else if(2==t.type)if(0==this.sessionStatus){var d=JSON.parse(t.data.SceneResult);d=$.extend(d,t);var c=this;this.countDownJump(function(){c.reSetDomStructure(t)},function(){c.reSetDomStructure(t)},d)}else{var o={cardName:t.cardName,url:"/InvestAdvise/"+this.cardData[t.cardName].UrlKey+".html?dt_from="+this.from};if(this.sMultiCondition&&(this.oldSMultiCondition=this.sMultiCondition),1==this.sessionStatus&&"cardMoneyFlow"!=this.cardData[t.cardName].UrlKey){for(var r=0;r<this.shareWords.length;r++)s+=0==r?this.shareWords[r]:"+"+this.shareWords[r];s+="+"+t.words,o.url="/InvestAdvise/cardMoneyFlow.html?dt_from="+this.from+"&words="+encodeURIComponent(s)+"&returnPre=1"}var i=this.createIframe(o);$(i).appendTo(e)}}};