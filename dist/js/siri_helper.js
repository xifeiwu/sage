"use strict";var NetConnector=function(t){this.profile="uat",this.ajaxHeaders=t,this.ajaxHeaders.token=window.localStorage.token,this.answerStyle={WAITING:1,ASK_HINT:2,PLAIN_TEXT:3,STOCK_QUOTATION:4,HOT_STOCKS:5,STOCK_HOT:6,STOCK_FORECAST:7}};NetConnector.prototype={setToken:function(t){t&&window.localStorage.token!==t&&(window.localStorage.token=t,this.ajaxHeaders.token=t)},getAjaxHost:function(t){var e=null;switch(t){case"uat_ip":e="http://10.19.93.129:8090/";break;case"uat":e="http://mtest.iqianjin.com/";break;case"product":e="https://m.benew.com.cn/"}return e},getQueryString:function(t){var e=[],a=function(t){for(key in t){var a=t[key];null!==a&&void 0!==a&&(a=a.toString(),key.length>0&&a.length>0&&e.push(key+"="+t[key]))}};return a(this.ajaxHeaders),a(t),e.join("&")},_getURL:function(t){var e=t.askType,a=this.getAjaxHost(this.profile),o=(window.localStorage.token,null);switch(e){case"FIRST_ASK":o="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({benew_id:t.benewId,msg:t.question});break;case"ASK":o="bot/api/v1/botServer/sessionOperator/receiveh5?"+this.getQueryString({msg:t.question});break;case"REFRESH":o="bot/api/v1/botServer/sessionOperator/flashh5?"+this.getQueryString({msg:t.question})}return a+o},throttle:function(t,e){"function"==typeof t&&(clearTimeout(t.timeoutId),t.timeoutId=setTimeout(function(){try{"object"==typeof e?t.call(null,e):t.call(null)}catch(t){console.log(t)}},300))},askServer:function(t,e){var a=t.askType;switch(a){case"FIRST_ASK":this._getSIRIAnswer(t,e);break;case"ASK":this._getSIRIAnswer(t,e);break;case"REFRESH":this._getSIRIAnswer(t,e);break;default:this._getSIRIAnswer(t,e)}},_getSIRIAnswer:function(t,e){var a=this,o=function(t){a.setToken(t.token);for(var o=t.content,s=[],r=0;r<o.length;r++){var n=o[r];if("type"in n)switch(n.type){case"recommend":s=n;break;case"help":s.push({style:a.answerStyle.ASK_HINT,content:n.data.body});break;case"hot":s.push({style:a.answerStyle.STOCK_HOT,content:n.data.body});break;case"forecast":s.push({style:a.answerStyle.STOCK_FORECAST,content:n.data.body});break;case"plain":s.push({style:a.answerStyle.PLAIN_TEXT,content:n.data.body});break;case"quotation":s.push({style:a.answerStyle.STOCK_QUOTATION,content:a._formatStockQuotation(n.data)});break;case"optimization":s.push({style:a.answerStyle.HOT_STOCKS,content:a._formatHotStocks(n.data)})}}e(null,s)},s=this._getURL(t);$.output(s),$.ajax({url:s,type:"get",contentType:"application/json;charset=utf-8",dataType:"json",timeout:12e3,headers:this.ajaxHeaders,success:function(t){$.output(t),0===parseInt(t.code)?o(t):e(new Error("data not valid"))},error:function(t,a,o){e(JSON.stringify(t))}})},_formatHotStocks:function(t){var e=t.body,a=t.predictLinks,o=e.date;return e.date=$.toLocaleFormat(new Date(o),"yyyy.MM.dd"),e.stocks.forEach(function(t){var e=parseFloat(t.topen),a=100*parseFloat(t.pchg),o="";t.topen=e.toFixed(2),a>0?(a="+"+a.toFixed(2)+"%",o="up"):a<0?(a=a.toFixed(2)+"%",o="down"):(a=a.toFixed(2)+"%",o="stay"),t.formated_pchg=a,t.pchg_state=o}),e.link=a[0],e},_formatStockQuotation:function(t){var e=t.body,a=t.predictLinks,o="";switch(e.stockStatus.toUpperCase()){case"S":o="开市前";break;case"C":o="集合竞价";break;case"T":o="交易中";break;case"B":o="休市";break;case"E":o="收盘";break;case"P":o="停牌"}e.stockStatus=o;var s=e.tradePrice;e.tradePrice=s.toFixed(2);var r=e.tradeDate;e.tradeDate=r.substr(4,2)+"-"+r.substr(6,2);var n=e.tradeTime;e.tradeTime=n.substr(0,2)+":"+n.substr(2,2)+":"+n.substr(4,2);var i=100*e.pchg,c="";i>0?(i="+"+i.toFixed(2)+"%",c="up"):i<0?(i=i.toFixed(2)+"%",c="down"):(i=i.toFixed(2)+"%",c="stay"),e.formated_pchg=i,e.pchg_state=c;var u=e.change;u>0&&(u="+"+u),e.change=u,e.thigh=e.thigh.toFixed(2),e.topen=e.topen.toFixed(2),e.tlow=e.tlow.toFixed(2),e.lclose=e.lclose.toFixed(2);var l=[];return a.forEach(function(t){l.push(t.text)}),e.links=l,e}};