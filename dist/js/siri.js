!function(){var t=function(t){console.log(t),this.container=t,this.askHint=$("#siri_ask_hint"),this.init()};t.prototype={init:function(){this.initDOM(),this.initEvent()},show:function(t){t?(this.askHint.removeClass("hidden"),this.askHint.addClass("show")):(this.askHint.removeClass("show"),this.askHint.addClass("hidden"))},initDOM:function(){function t(t){function i(t){var i='<div class="swiper-slide"><ul class="hint_list move_up">';return t.forEach(function(t){i+="<li>"+t+"</li>"}),i+="</ul></div>"}for(var s="",e=0;e<t.length;e++)s+=i(t[e].items);return answerDom='<div class="content"><h2>你可以这样问我:</h2><div class="swiper-container swiper-container-horizontal" id="swiper"><div class="swiper-wrapper ">'+s+'</div></div><div class="btn_change_slider" id="btnChange"><div class="btn_change_inside"><span>换一换</span></div></div><div class="close"><div class="btn"></div></div></div>',answerDom}this.container.netConnector.askSIRIServer({type:"ASK",question:"recommend"},function(i,s){var e=null;i?e=localStorage.ASK_HINT?JSON.parse(localStorage.ASK_HINT):[{items:["600519","开户","选股","KDJ","茅台行情"]}]:(e=s.data.body,localStorage.ASK_HINT=JSON.stringify(e));var n=t(e);this.askHint.html(""),this.askHint.append($(n));try{this.mySwiper=new Swiper(".swiper-container",{autoplay:3e3,speed:800,loop:!0,onlyExternal:!0,onDestroy:function(t){},autoplayDisableOnInteraction:!1,effect:"fade",fade:{crossFade:!0},direction:"horizontal"})}catch(t){$.mobileConsole(t)}}.bind(this))},initEvent:function(){$.touchEvent(this.askHint,".hint_list li",function(t){this.container.askSIRI(t.target.textContent),this.show(!1)}.bind(this)),$.touchEvent(this.askHint,"#btnChange .btn_change_inside",function(){this.mySwiper.slideNext()}.bind(this)),$.touchEvent(this.askHint,".close",function(){this.show(!1)}.bind(this))}};var i=function(){this.from=null==$.getQueryString("from")||"app"==$.getQueryString("from")?"app":"web",this.env=$.getQueryString("env"),this.cardCnt=1,this.cardName="card_1",this.sessionAjaxCount=0,this.sessionStatus=0,this.dialogWrapper=document.getElementById("dialog_wrapper"),this.wrapperHeight=$(this.dialogWrapper).height(),this.cardStyle={SIRI_INTRO:1,CONVERSATION:3},this.netConnector=new NetConnector,this.answerStyle=this.netConnector.answerStyle};i.prototype={init:function(){this.siriAskHint=new t(this),this.addEvent(),this.createCard({type:this.cardStyle.SIRI_INTRO})},addEvent:function(){$("#input_bar .btn_go").on("click",function(){var t=$("#input_bar input");this.askSIRI(t.val()),t.val(""),t.blur()}.bind(this)),$("#input_bar input").on("keydown",function(t){var i=t||window.event;if(i&&13==i.keyCode){var s=$("#input_bar input");this.askSIRI(s.val()),s.val(""),s.blur()}}.bind(this)),$.touchEvent($("#dialog"),".show_ask_hint",function(){this.siriAskHint.show(!0)}.bind(this)),$.touchEvent($("#dialog"),".active_link",function(t){var i=t.target;$.output(i.dataset.question),this.askSIRI(i.dataset.question)}.bind(this))},askSIRI:function(t){if(console.log(t),t&&0!=t.length&&(t=t.trim(),t.length>0)){options={type:this.cardStyle.CONVERSATION,data:t};var i=this.createCard(options);this.netConnector.askSIRIServer({tyep:"ASK",question:t},function(t,s){t&&(s=[{type:"plain",data:"网络好像出了些问题。。。"}]),this.hideLoading(options),s.forEach(function(t){i.append($(this.createAnswerDOM(t))),this.bottomDiv({cardName:this.cardName}),this.scrollTopAnimate({cardName:this.cardName,callBack:function(){}})}.bind(this))}.bind(this))}},createAnswerDOM:function(t){var i="";switch(t.style){case this.answerStyle.WAITING:i='<div class="ans_box"><div class="ico_dots dots_loading"><i></i><i></i><i></i></div></div>';break;case this.answerStyle.ASK_HINT:i=this.createAnswerDOM({style:this.answerStyle.PLAIN_TEXT,showType:"new",data:t.data})+'<div class="show_ask_hint"><span>你可以这样问我 ></span></div>';break;case this.answerStyle.PLAIN_TEXT:i='<div class="ans_box">'+t.data+"</div>";break;case this.answerStyle.STOCK_HOT:i='<div class="ans_box" id="stock_hot">'+t.data+"</div>";break;case this.answerStyle.STOCK_FORECAST:i='<div class="ans_box" id="stock_forecast">'+t.data+"</div>";break;case this.answerStyle.STOCK_QUOTATION:var s=t.data;i='<div class="ans_box" id="stock_quotation"><div class="header"><div class="title">'+s.tradeName+"&nbsp"+s.tradeCode+'</div><div class="status">'+s.stockStatus+"&nbsp"+s.tradeDate+"&nbsp"+s.tradeTime+'</div></div> <div class="content"><div class="first"><div class="trade_price">'+s.tradePrice+'</div><div class="price_change"><div class="change">'+s.change+'</div><div class="pchg">'+s.pchg+'</div></div></div><div class="second price_show"><div><span>最&nbsp高</span><span>&nbsp'+s.thigh+"</span></div><div><span>今&nbsp开</span><span>&nbsp"+s.topen+'</span></div></div><div class="third price_show"><div><span>最&nbsp低</span><span>&nbsp'+s.tlow+"</span></div><div><span>昨&nbsp收</span><span>&nbsp"+s.lclose+'</span></div></div></div><div class="footer"><div class="active_link" data-question="'+s.tradeCode+'预测">预测</div><div class="active_link" data-question="'+s.tradeCode+'热点">热点</div></div></div>';break;case this.answerStyle.HOT_STOCKS:var s=t.data,e=s.stocks.map(function(t){return'<tr><td><span class="stock_name">'+t.name+'</span>&nbsp<span class="stock_code">'+t.code+"</span></td><td>"+t.topen+'</td><td class="pchg">'+t.pchg+"</td></tr>"}).join(""),i='<div class="ans_box" id="hot_stocks"><div class="stock_qutation"><div class="top">会牛智选</div><div class="content"><div class="title">今日入选（'+s.date+'）</div><div class="list"><table class="stock_list"><tr><th>股票名称</th><th>入选价</th><th>最新涨幅</th></tr>'+e+'</table></div></div><div class="footer active_link">点击获取更多&nbsp></div></div></div>'}return'<div class="answer_row"><div class="ans_logo"><i class="benew_logo"></i></div><div class="ans_cont">'+i+"</div></div>"},limitCardNumb:function(){var t=10,i=$(".card");if(i.length>t)for(var s=0,e=i.length-t;s<e;s++)$(i[s]).remove()},createCard:function(t){this.limitCardNumb(),this.cardCnt+=1,this.cardName="card_"+this.cardCnt;var i="",s="";switch(t.type){case this.cardStyle.SIRI_INTRO:i="",s=this.createAnswerDOM({style:this.answerStyle.PLAIN_TEXT,showType:"new",data:"您好，我是牛博士，私人理财专家，有关股票证券问题都可以问我"});break;case this.cardStyle.CONVERSATION:i='<div class="ask_row"><span>'+t.data+"</span></div>",s=this.createAnswerDOM({style:this.answerStyle.WAITING})}"selectStockTips"==t.type?(i="",s=this.createAnswerDOM(t)):"onlyAnswer"==t.type&&(i="",s=this.createAnswerDOM(t));var e=$("<div id='"+this.cardName+"' class='card' style='overflow: hidden;'>"+i+s+"</div>");return e.insertBefore($("#bottomDiv")),e},hideLoading:function(t){$(".answer_row .ans_cont .ans_box .dots_loading").closest(".answer_row").remove()},createIframe:function(t){var i=t.url,s=$(window).width()-50-26,e=document.createElement("iframe");return e.name=t.cardName,e.setAttribute("style","visibility:hidden;overflow: hidden;"),e.setAttribute("width",s),e.setAttribute("border","none"),e.setAttribute("frameborder","no"),e.setAttribute("src",i),e.onerror=function(){},e},showIframe:function(t){var i=$(window).width()-50-26,s=document.getElementsByName(t.cardName)[0];$(s.contentWindow.document.body).width(i+"px");var e=this;setTimeout(function(){e.updateIframe(t),$(s).attr("style","visibility：visible;overflow: hidden;")},10)},updateIframe:function(t){var i=t.cardName;if(document.getElementsByName(i).length>0){var s=document.getElementsByName(i)[0],e=$(s.contentWindow.document.body)[0].offsetHeight+12,n=$(window).width()-50-26;$(s.contentWindow.document.body).width(n+"px"),$(s).attr("height",e),$(s).attr("width",n),this.bottomDiv(t)}},scrollTopAnimate:function(t){var i=this,s=!0,e=300,n=document.getElementById(this.cardName).offsetTop,a=this.dialogWrapper.scrollTop,o=40,r=(n-a)/e*o;v=function(){Math.abs(a-n)>r?s?(a+=r,i.dialogWrapper.scrollTop=a,window.setTimeout(v,o)):(a=n,s=!1,i.dialogWrapper.scrollTop=a,t.callBack()):(a=n,i.dialogWrapper.scrollTop=a,s=!1)},v(),setTimeout(function(){s=!1},e+200)},bottomDiv:function(t){var i=$("#"+this.cardName),s=i.height(),e=this.wrapperHeight-s;e=this.wrapperHeight-s>0?this.wrapperHeight-s:0,$("#bottomDiv").css("height",e)},openUrl:function(t){location.href=t.url}},benewSIRI=new i,benewSIRI.init(),window.benewSIRI=benewSIRI}();