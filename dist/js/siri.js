!function(){var t=function(t){console.log(t),this.container=t,this.askHintDOM=$("#siri_ask_hint"),this.init()};t.prototype={init:function(){this.initDOM(),this.initEvent()},show:function(t){t?(this.askHintDOM.removeClass("hidden"),this.askHintDOM.addClass("show"),this.mySwiper.startSlide&&this.mySwiper.startSlide()):(this.askHintDOM.removeClass("show"),this.askHintDOM.addClass("hidden"),this.mySwiper.stopSlide&&this.mySwiper.stopSlide())},initDOM:function(){function t(t){function i(t){var i='<div class="swiper-slide"><ul class="hint_list move_up">';return t.forEach(function(t){i+="<li>"+t+"</li>"}),i+="</ul></div>"}for(var e="",s=0;s<t.length;s++)e+=i(t[s].items);return answerDom='<div class="content"><h2>你可以这样问我:</h2><div class="swiper-container swiper-container-horizontal" id="swiper"><div class="swiper-wrapper ">'+e+'</div></div><div class="btn_change_wrapper"><span class="btn_change">换一换</span></div><div class="btn_close_wrapper"><span class="btn_close"></span></div></div>',answerDom}this.container.netConnector.askServer({type:"ASK",question:"recommend"},function(i,e){var s=null;i?s=localStorage.ASK_HINT?JSON.parse(localStorage.ASK_HINT):[{items:["600519","开户","选股","KDJ","茅台行情"]}]:(s=e.data.body,localStorage.ASK_HINT=JSON.stringify(s));var n=t(s);this.askHintDOM.html(""),this.askHintDOM.append($(n)),this.mySwiper=this.addSwiper(),this.askHintDOM.addClass("hidden")}.bind(this))},addSwiper:function(){for(var t={},i=this.askHintDOM.find(".swiper-wrapper").eq(0),e=i.find(".swiper-slide"),s=i.width(),n=0;n<e.length;n++){var a=$(e[n]);a.data("swiperSlideIndex",n),a.css({transform:"translate3d("+s*n*-1+"px, 0px, 0px)"}),a.removeClass("swiper-slide-active")}return e.length>0&&(t.activeId=0,t.swiperSlides=e,t.slideNext=function(){var i=e[t.activeId],s=(t.activeId+1)%e.length;console.log(s),i.classList.remove("swiper-slide-active"),e[s].classList.add("swiper-slide-active"),t.activeId=s},t.slideNextManually=function(){t.interVal&&clearInterval(t.interVal),t.slideNext(),t.startSlide()},t.startSlide=function(){t.stopSlide(),e[t.activeId].classList.add("swiper-slide-active"),t.interVal=setInterval(t.slideNext,3e3)},t.stopSlide=function(){t.interVal&&clearInterval(t.interVal),Array.prototype.slice.call(t.swiperSlides).forEach(function(t){t.classList.remove("swiper-slide-active")})}),t},initEvent:function(){$.touchEvent(this.askHintDOM,".swiper-slide-active .hint_list li",function(t){var i=t.target.textContent;$.output(i),this.container.askSIRI(i),this.show(!1)}.bind(this)),$.touchEvent(this.askHintDOM,".btn_change_wrapper .btn_change",function(){this.mySwiper.slideNextManually&&this.mySwiper.slideNextManually()}.bind(this)),$.touchEvent(this.askHintDOM,".btn_close_wrapper .btn_close",function(){this.show(!1)}.bind(this))}};var i=function(){this.from=null==$.getQueryString("from")||"app"==$.getQueryString("from")?"app":"web",this.env=$.getQueryString("env"),this.cardCnt=1,this.cardName="card_1",this.sessionAjaxCount=0,this.sessionStatus=0,this.dialogWrapper=document.getElementById("dialog_wrapper"),this.wrapperHeight=$(this.dialogWrapper).height(),this.cardStyle={SIRI_SAY:1,USER_ASK:3},this.netConnector=new NetConnector,this.answerStyle=this.netConnector.answerStyle};i.prototype={init:function(){this.siriAskHint=new t(this),this.addEvent(),this.siriSay("hi")},addEvent:function(){$("#input_bar .btn_go").on("click",function(){var t=$("#input_bar input");this.askSIRI(t.val()),t.val(""),t.blur()}.bind(this)),$("#input_bar input").on("keydown",function(t){var i=t||window.event;if(i&&13==i.keyCode){var e=$("#input_bar input");this.askSIRI(e.val()),e.val(""),e.blur()}}.bind(this)),$.touchEvent($("#dialog"),".show_ask_hint",function(){this.siriAskHint.show(!0)}.bind(this)),$.touchEvent($("#dialog"),".active_link",function(t){var i=t.target,e=null;e=i.dataset.question?i.dataset.question:$(i).text(),$.output(e),e&&this.askSIRI(e)}.bind(this))},siriSay:function(t){t&&0!=t.length&&(t=t.trim(),t.length>0&&this.netConnector.askServer({type:"ASK",question:t},function(t,i){t&&(i=[{type:this.answerStyle.PLAIN_TEXT,content:"您好，我是哲，私人理财专家，有关股票证券问题都可以问我。"}]);this.createCard({type:this.cardStyle.SIRI_SAY,content:i});this.bottomDiv({cardName:this.cardName}),this.scrollTopAnimate({cardName:this.cardName,callBack:function(){}})}.bind(this)))},askSIRI:function(t){if(t&&0!=t.length&&(t=t.trim(),t.length>0)){var i=this.createCard({type:this.cardStyle.USER_ASK,content:t});this.netConnector.askServer({type:"ASK",question:t},function(t,e){t&&(e=[{style:this.answerStyle.PLAIN_TEXT,content:"网络好像出了些问题。。。"}]),this.hideLoading();var s=e.map(function(t){return this.createAnswerDOM(t)}.bind(this)).join("");i.append($(s)),this.bottomDiv({cardName:this.cardName}),this.scrollTopAnimate({cardName:this.cardName,callBack:function(){}})}.bind(this))}},createAnswerDOM:function(t){var i="";switch($.output(t),t.style){case this.answerStyle.WAITING:i='<div class="ans_box"><div class="ico_dots dots_loading"><i></i><i></i><i></i></div></div>';break;case this.answerStyle.ASK_HINT:return this.createAnswerDOM({style:this.answerStyle.PLAIN_TEXT,content:t.content})+'<div class="show_ask_hint"><span>你可以这样问我 ></span></div>';case this.answerStyle.PLAIN_TEXT:i='<div class="ans_box">'+t.content+"</div>";break;case this.answerStyle.STOCK_HOT:i='<div class="ans_box" id="stock_hot">'+t.content+"</div>";break;case this.answerStyle.STOCK_FORECAST:i='<div class="ans_box" id="stock_forecast">'+t.content+"</div>";break;case this.answerStyle.STOCK_QUOTATION:var e=t.content;i='<div class="ans_box" id="stock_quotation"><div class="header"><div class="title">'+e.tradeName+"&nbsp"+e.tradeCode+'</div><div class="status">'+e.stockStatus+"&nbsp"+e.tradeDate+"&nbsp"+e.tradeTime+'</div></div> <div class="content"><div class="first item '+e.pchg_state+'"><div class="trade_price">'+e.tradePrice+'</div><div class="price_change"><div class="change">'+e.change+'</div><div class="pchg">'+e.formated_pchg+'</div></div></div><div class="item price_show"><div class="sub_item"><div><span>最&nbsp高</span><span>&nbsp'+e.thigh+"</span></div><div><span>今&nbsp开</span><span>&nbsp"+e.topen+'</span></div></div></div><div class="item price_show"><div class="sub_item"><div><span>最&nbsp低</span><span>&nbsp'+e.tlow+"</span></div><div><span>昨&nbsp收</span><span>&nbsp"+e.lclose+'</span></div></div></div></div><div class="footer">'+e.links.map(function(t){return'<div class="active_link">'+t+"</div>"}).join("")+"</div></div>";break;case this.answerStyle.HOT_STOCKS:var e=t.content,s=e.stocks.map(function(t){return'<tr><td><span class="stock_name">'+t.name+'</span>&nbsp<span class="stock_code">'+t.code+"</span></td><td>"+t.topen+'</td><td class="pchg '+t.pchg_state+'">'+t.formated_pchg+"</td></tr>"}).join(""),i='<div class="ans_box" id="hot_stocks"><div class="header">会牛智选</div><div class="content"><div class="title">今日入选（'+e.date+'）</div><table class="stock_list"><tr><th>股票名称</th><th>入选价</th><th>最新涨幅</th></tr>'+s+'</table></div><a class="footer" href="'+e.link.link+'">'+e.link.text+"&nbsp></a></div>"}return'<div class="answer_row"><div class="ans_logo"><i class="benew_logo"></i></div><div class="ans_cont">'+i+"</div></div>"},limitCardNumb:function(){var t=10,i=$(".card");if(i.length>t)for(var e=0,s=i.length-t;e<s;e++)$(i[e]).remove()},createCard:function(t){this.limitCardNumb(),this.cardCnt+=1,this.cardName="card_"+this.cardCnt;var i="",e="";switch(t.type){case this.cardStyle.SIRI_SAY:i="";var s=t.content;e=s.map(function(t){return this.createAnswerDOM({style:t.style,content:t.content})}.bind(this)).join("");break;case this.cardStyle.USER_ASK:i='<div class="ask_row"><span>'+t.content+"</span></div>",e=this.createAnswerDOM({style:this.answerStyle.WAITING})}"selectStockTips"==t.type?(i="",e=this.createAnswerDOM(t)):"onlyAnswer"==t.type&&(i="",e=this.createAnswerDOM(t));var n=$("<div id='"+this.cardName+"' class='card' style='overflow: hidden;'>"+i+e+"</div>");return n.insertBefore($("#bottomDiv")),n},hideLoading:function(){$(".answer_row .ans_cont .ans_box .dots_loading").closest(".answer_row").remove()},createIframe:function(t){var i=t.url,e=$(window).width()-50-26,s=document.createElement("iframe");return s.name=t.cardName,s.setAttribute("style","visibility:hidden;overflow: hidden;"),s.setAttribute("width",e),s.setAttribute("border","none"),s.setAttribute("frameborder","no"),s.setAttribute("src",i),s.onerror=function(){},s},showIframe:function(t){var i=$(window).width()-50-26,e=document.getElementsByName(t.cardName)[0];$(e.contentWindow.document.body).width(i+"px");var s=this;setTimeout(function(){s.updateIframe(t),$(e).attr("style","visibility：visible;overflow: hidden;")},10)},updateIframe:function(t){var i=t.cardName;if(document.getElementsByName(i).length>0){var e=document.getElementsByName(i)[0],s=$(e.contentWindow.document.body)[0].offsetHeight+12,n=$(window).width()-50-26;$(e.contentWindow.document.body).width(n+"px"),$(e).attr("height",s),$(e).attr("width",n),this.bottomDiv(t)}},scrollTopAnimate:function(t){var i=this,e=!0,s=300,n=document.getElementById(this.cardName).offsetTop,a=this.dialogWrapper.scrollTop,r=40,o=(n-a)/s*r;v=function(){Math.abs(a-n)>o?e?(a+=o,i.dialogWrapper.scrollTop=a,window.setTimeout(v,r)):(a=n,e=!1,i.dialogWrapper.scrollTop=a,t.callBack()):(a=n,i.dialogWrapper.scrollTop=a,e=!1)},v(),setTimeout(function(){e=!1},s+200)},bottomDiv:function(t){var i=$("#"+this.cardName),e=i.height(),s=this.wrapperHeight-e;s=this.wrapperHeight-e>0?this.wrapperHeight-e:0,$("#bottomDiv").css("height",s)},openUrl:function(t){location.href=t.url}},benewSIRI=new i,benewSIRI.init(),window.benewSIRI=benewSIRI}();